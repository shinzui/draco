// Generated by BUCKLESCRIPT VERSION 3.1.5, PLEASE EDIT WITH CARE
'use strict';

var List = require("bs-platform/lib/js/list.js");
var $$String = require("bs-platform/lib/js/string.js");
var Caml_array = require("bs-platform/lib/js/caml_array.js");
var Utils$LidcoreDraco = require("../lib/utils.js");
var Process$LidcoreBsNode = require("@lidcore/bs-node/src/process.js");
var Caml_builtin_exceptions = require("bs-platform/lib/js/caml_builtin_exceptions.js");
var DracoCommon$LidcoreDraco = require("./dracoCommon.js");
var Child_process$LidcoreBsNode = require("@lidcore/bs-node/src/child_process.js");

var usage = DracoCommon$LidcoreDraco.usage("image build [base|app|both]");

var arg = /* Some */[usage];

function packer(args, config) {
  var config$1 = Utils$LidcoreDraco.$$escape("" + (String(DracoCommon$LidcoreDraco.baseDir) + ("/packer/" + (String(config) + ""))));
  var args$1 = List.map((function (param) {
          var opt = Utils$LidcoreDraco.$$escape("" + (String(param[0]) + ("=" + (String(param[1]) + ""))));
          return "-var " + (String(opt) + "");
        }), args);
  var args$2 = $$String.concat(" ", args$1);
  var stdio_000 = /* stdin : `Inherit */[
    -72987685,
    Process$LidcoreBsNode.stdin
  ];
  var stdio_001 = /* stdout : `Inherit */[
    -72987685,
    Process$LidcoreBsNode.stdout
  ];
  var stdio_002 = /* stderr : `Inherit */[
    -72987685,
    Process$LidcoreBsNode.stderr
  ];
  var stdio = /* record */[
    stdio_000,
    stdio_001,
    stdio_002
  ];
  Child_process$LidcoreBsNode.spawn(/* None */0, /* None */0, /* Some */[stdio], /* Some */[true], "packer build -force " + (String(args$2) + (" " + (String(config$1) + ""))));
  return /* () */0;
}

var argc = Process$LidcoreBsNode.argv.length;

if (argc !== 4) {
  DracoCommon$LidcoreDraco.die(/* None */0, arg, /* () */0);
}

if (Caml_array.caml_array_get(Process$LidcoreBsNode.argv, 2) !== "build") {
  DracoCommon$LidcoreDraco.die(/* None */0, arg, /* () */0);
}

var match = Caml_array.caml_array_get(Process$LidcoreBsNode.argv, 3);

var mode;

switch (match) {
  case "app" : 
      mode = /* App */3257473;
      break;
  case "base" : 
      mode = /* Base */736760881;
      break;
  case "both" : 
      mode = /* Both */737457313;
      break;
  default:
    mode = DracoCommon$LidcoreDraco.die(/* Some */["Invalid mode"], arg, /* () */0);
}

var config = DracoCommon$LidcoreDraco.config(/* () */0);

var args_000 = /* tuple */[
  "project",
  config.projectId
];

var args_001 = /* :: */[
  /* tuple */[
    "zone",
    config.zone
  ],
  /* [] */0
];

var args = /* :: */[
  args_000,
  args_001
];

if (mode !== 736760881) {
  throw [
        Caml_builtin_exceptions.assert_failure,
        [
          "dracoImage.ml",
          50,
          11
        ]
      ];
} else {
  packer(args, "base.json");
}

/* usage Not a pure module */
